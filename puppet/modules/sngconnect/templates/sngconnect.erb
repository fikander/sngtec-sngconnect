#!/bin/bash

BASE=/home/vagrant
VIRTUALENV=$BASE/environment
CONFIGURATION=/vagrant/development.ini
USER=vagrant

LOG_FILE=$BASE/var/log/pserve.log
PID_FILE=$BASE/var/run/pserve.pid

start_application()
{
    su $USER -c ". $VIRTUALENV/bin/activate && pserve $CONFIGURATION --reload --monitor-restart --daemon --pid-file=$PID_FILE --log-file=$LOG_FILE"
}

stop_application()
{
    su $USER -c ". $VIRTUALENV/bin/activate && pserve $CONFIGURATION --stop-daemon --pid-file=$PID_FILE"
}

case "$1" in
    start)
        start_application
        exit $?
        ;;
    stop)
        stop_application
        exit $?
        ;;
    restart)
        stop_application && start_application
        exit $?
        ;;
    status)
        su $USER -c ". $VIRTUALENV/bin/activate && pserve $CONFIGURATION --status --pid-file=$PID_FILE"
        exit $?
        ;;
    *)
        echo "Usage: $0 {start|stop|restart|status}" >&2
        exit 1
        ;;
esac
